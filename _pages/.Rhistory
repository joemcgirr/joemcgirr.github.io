select(-c(STRONGEST_SNP)) |>
arrange(P.VALUE) |>
inner_join(vcf, by = c("SNPS" = "ID"))
names(catalog_matches) <- to_snake_case(names(catalog_matches))
match_stats <- data.frame(column = c("rsIDs",
"phenotypes",
"journals"),
n = c(length(unique(catalog_matches$snps)),
length(unique(catalog_matches$mapped_trait)),
length(unique(catalog_matches$journal))))
match_stats |> gt() |> tab_header(title = "Catalog Matches")
catalog_matches[4:9,] |> gt() |> tab_header(title = "Examples of Catalog Matches")
homozygous_for_risk_allele <- filter(catalog_matches,vcf_allele_1 == risk_allele, vcf_allele_2 == risk_allele, p_value < 1e-20) |>
arrange(risk_allele_frequency, p_value)
homozygous_for_risk_allele_low_freq <- filter(catalog_matches,vcf_allele_1 == risk_allele, vcf_allele_2 == risk_allele, risk_allele_frequency < 0.1, p_value < 1e-20) |>
arrange(p_value) |>
select(c(disease_trait, p_value, or_or_beta, risk_allele, snps, link))
p1 <- catalog_matches |>
ggplot(aes(risk_allele_frequency)) +
geom_histogram(bins = 100) +
theme_minimal() +
theme(axis.title.x=element_text(size=14),
axis.title.y=element_text(size=12),
axis.title=element_text(size=14),
axis.text=element_text(size=12),
plot.title=element_text(size=18)) +
xlim(0,1) +
ggtitle("Distribution of risk allele frequencies") +
geom_vline(xintercept = 0.1, color = red, linetype = 2)
print(p1)
head(homozygous_for_risk_allele_low_freq) |> gt() |>
tab_header(title = "Homozygous for risk allele") |>
fmt(columns = 'link',fns = make.hyperlink)
homozygous_for_risk_allele_low_freq
prs_output_path <- "C:/Users/jmcgirr/dna/prskb/PRS_default.tsv"
prs <- read_tsv(prs_output_path) |>
filter(!is.na(Percentile)) |>
filter(`SNP Overlap` > 10) |>
arrange(desc(Percentile))
view(prs)
view(prs)
BiocManager::install("gwascat", force = TRUE)
library(gwascat)
library(gwascat)
install.packages("rlang")
install.packages("rlang")
library(gwascat)
install.packages("cli")
install.packages("cli")
install.packages("cli")
install.packages("cli")
install.packages("cli")
library(gwascat)
library(gwascat)
update.packages(ask = FALSE)
update.packages(ask = FALSE)
library(devtools)
update.packages(ask = FALSE)
update.packages(ask = FALSE)
install.packages("RCurl", type = "binary")
install.packages("fs", type = "binary")
start_time <- Sys.time()
library(snakecase)
library(gt)
suppressPackageStartupMessages(library(tidyverse))
library(gwascat)
# Wong, B. Points of view: Color blindness. Nat Methods (2011).
bla <- '#000000'
blu <- '#0072b2'
grb <- '#56b4e9'
lir <- '#cc79a7'
gre <- '#009e73'
red <- '#d55e00'
org <- '#e69f00'
yel <- '#f0e442'
gry <- '#BBBBBB'
make.hyperlink <-  function(myurl,mytext=myurl) {
paste('<a href="',myurl,'">',mytext,'</a>')
}
gwtrunc <- makeCurrentGwascat()
gwtrunc <- makeCurrentGwascat(table.url = "C:/Users/jmcgirr/Downloads/gwas_catalog_v1.0.2-associations_e105_r2022-04-07.tsv")
60*24
60*60
3600*24
options(timeout = 86400)
gwtrunc <- makeCurrentGwascat()
# Chunk 1
pre, code {white-space:pre !important; overflow-x:auto}
# Chunk 2
start_time <- Sys.time()
library(snakecase)
library(gt)
suppressPackageStartupMessages(library(tidyverse))
library(gwascat)
# Wong, B. Points of view: Color blindness. Nat Methods (2011).
bla <- '#000000'
blu <- '#0072b2'
grb <- '#56b4e9'
lir <- '#cc79a7'
gre <- '#009e73'
red <- '#d55e00'
org <- '#e69f00'
yel <- '#f0e442'
gry <- '#BBBBBB'
make.hyperlink <-  function(myurl,mytext=myurl) {
paste('<a href="',myurl,'">',mytext,'</a>')
}
# Chunk 5
myVariants_path <- "C:/Users/jmcgirr/dna/kimiko/vcf/myVariants.ann.txt"
# Nebula vcf
vcf <- read_tsv(myVariants_path, col_select = c("CHROM","POS","TYPE","ID","myVariants.GT")) |>
# only check SNPs
filter(TYPE == "SNP") |> select(-c(TYPE)) |>
separate(myVariants.GT, c("vcf_allele1","vcf_allele2"), sep = "/|\\|") |>
# remove deletions labeled as "*"
filter(vcf_allele1 != "*",vcf_allele2 != "*") |>
# remove rows with missing rsid
filter(str_detect(ID,fixed("rs")))
head(as.data.frame(vcf))
options(timeout = 86400)
gwtrunc <- makeCurrentGwascat()
#topTraits(gwtrunc)
catalog_matches <-  as.data.frame(gwtrunc) |>
filter(SNPS %in% vcf$ID) |>
select(-c(DATE.ADDED.TO.CATALOG, FIRST.AUTHOR, width, STUDY, REGION, CHR_ID,
UPSTREAM_GENE_ID, DOWNSTREAM_GENE_ID, SNP_GENE_IDS, UPSTREAM_GENE_DISTANCE,
DOWNSTREAM_GENE_DISTANCE,MERGED, SNP_ID_CURRENT,PVALUE_MLOG,PLATFORM..SNPS.PASSING.QC.,
STUDY.ACCESSION,P.VALUE..TEXT.,PUBMEDID)) |>
separate(STRONGEST.SNP.RISK.ALLELE, c("STRONGEST_SNP","RISK_ALLELE"), sep = "-" ,remove = TRUE) |>
select(-c(STRONGEST_SNP)) |>
arrange(P.VALUE) |>
inner_join(vcf, by = c("SNPS" = "ID"))
names(catalog_matches) <- to_snake_case(names(catalog_matches))
match_stats <- data.frame(column = c("rsIDs",
"phenotypes",
"journals"),
n = c(length(unique(catalog_matches$snps)),
length(unique(catalog_matches$mapped_trait)),
length(unique(catalog_matches$journal))))
match_stats |> gt() |> tab_header(title = "Catalog Matches")
catalog_matches[4:9,] |> gt() |> tab_header(title = "Examples of Catalog Matches")
# Chunk 6
het_or_hom_for_risk_allele <- filter(catalog_matches,vcf_allele_1 == risk_allele | vcf_allele_2 == risk_allele, p_value < 1e-20) |>
arrange(risk_allele_frequency, p_value) |>
select(c(disease_trait, p_value, or_or_beta, risk_allele, snps, link))
head(het_or_hom_for_risk_allele) |> gt() |>
tab_header(title = "Heterozygous for risk allele") |>
fmt(columns = 'link',fns = make.hyperlink)
# Chunk 7
homozygous_for_risk_allele <- filter(catalog_matches,vcf_allele_1 == risk_allele, vcf_allele_2 == risk_allele, p_value < 1e-20) |>
arrange(risk_allele_frequency, p_value)
homozygous_for_risk_allele_low_freq <- filter(catalog_matches,vcf_allele_1 == risk_allele, vcf_allele_2 == risk_allele, risk_allele_frequency < 0.1, p_value < 1e-20) |>
arrange(p_value) |>
select(c(disease_trait, p_value, or_or_beta, risk_allele, snps, link))
p1 <- catalog_matches |>
ggplot(aes(risk_allele_frequency)) +
geom_histogram(bins = 100) +
theme_minimal() +
theme(axis.title.x=element_text(size=14),
axis.title.y=element_text(size=12),
axis.title=element_text(size=14),
axis.text=element_text(size=12),
plot.title=element_text(size=18)) +
xlim(0,1) +
ggtitle("Distribution of risk allele frequencies") +
geom_vline(xintercept = 0.1, color = red, linetype = 2)
print(p1)
head(homozygous_for_risk_allele_low_freq) |> gt() |>
tab_header(title = "Homozygous for risk allele") |>
fmt(columns = 'link',fns = make.hyperlink)
# Chunk 8
myVariants_path <- "C:/Users/jmcgirr/dna/kimiko/vcf/myVariants.ann.txt"
# Nebula vcf
rsid_and_genotype <- read_tsv(myVariants_path, col_select = c("ID","myVariants.GT")) |>
mutate(myVariants.GT = gsub("/|\\|", "," ,myVariants.GT)) |>
# remove deletions labeled as "*"
#filter(vcf_allele1 != "*",vcf_allele2 != "*") |>
# remove rows with missing rsid
filter(str_detect(ID,fixed("rs"))) |>
unite("ID_genotype", c("ID", "myVariants.GT"), sep = ":")
head(as.data.frame(rsid_and_genotype))
# write.table(rsid_and_genotype,"C:/Users/jmcgirr/dna/kimiko/prskb/rsid_and_genotype.txt", row.names = FALSE, quote = FALSE, sep = "\t", col.names = FALSE)
# Chunk 10
prs_output_path <- "C:/Users/jmcgirr/dna/kimiko/prskb/PRS_default_EUR.tsv"
prs <- read_tsv(prs_output_path) |>
filter(!is.na(Percentile)) |>
filter(`SNP Overlap` > 10) |>
arrange(desc(Percentile))
#view(prs)
# high_percentile <- tail(prs,(nrow(prs)-8572)) |>
#   filter(`SNP Overlap` > 10)
# nrow(high_percentile)
head(select(prs,c(`Reported Trait`, `Trait`, `Citation`, `Included SNPs`, `Polygenic Risk Score`, `Percentile`))) |>
gt() |>
tab_header(title = "PRSKB command line tool output")
# Chunk 11
prs_output_path <- "C:/Users/jmcgirr/dna/kimiko/prskb/PRS_default_EAS.tsv"
prs <- read_tsv(prs_output_path) |>
filter(!is.na(Percentile)) |>
filter(`SNP Overlap` > 10) |>
arrange(desc(Percentile))
#view(prs)
# high_percentile <- tail(prs,(nrow(prs)-8572)) |>
#   filter(`SNP Overlap` > 10)
# nrow(high_percentile)
head(select(prs,c(`Reported Trait`, `Trait`, `Citation`, `Included SNPs`, `Polygenic Risk Score`, `Percentile`))) |>
gt() |>
tab_header(title = "PRSKB command line tool output")
prs
view(prs)
prs_output_path <- "C:/Users/jmcgirr/dna/kimiko/prskb/PRS_default_EUR.tsv"
prs <- read_tsv(prs_output_path) |>
filter(!is.na(Percentile)) |>
filter(`SNP Overlap` > 10) |>
arrange(desc(Percentile))
view(prs)
suppressPackageStartupMessages(library(tidyverse))
library(rsnps)
library(gt)
annotated_vcf_table <- "C:/Users/jmcgirr/dna/nebula/vcf/myVariants.clinvar.txt"
ann <- read_table(annotated_vcf_table, guess_max = 1000000) |>
filter(!is.na(ALLELEID))
patho <- filter(ann, str_detect(CLNSIG, fixed("Pathogenic")) | str_detect(CLNSIG, fixed("Likely_pathogenic"))) |> separate("ID", c("ID","unknown"), sep = ";")
unique(patho$CLNSIG)
nrow(patho)
patho
ann
#unique(patho$CLNSIG)
#nrow(patho)
as.data.frame(patho) |> gt()
annotated_vcf_table <- "C:/Users/jmcgirr/dna/kimiko/vcf/myVariants.clinvar.txt"
ann <- read_table(annotated_vcf_table, guess_max = 1000000) |>
filter(!is.na(ALLELEID))
patho <- filter(ann, str_detect(CLNSIG, fixed("Pathogenic")) | str_detect(CLNSIG, fixed("Likely_pathogenic"))) |> separate("ID", c("ID","unknown"), sep = ";")
#unique(patho$CLNSIG)
#nrow(patho)
as.data.frame(patho) |> gt()
annotated_vcf_table <- "C:/Users/jmcgirr/dna/kimiko/vcf/myVariants.clinvar.txt"
ann <- read_table(annotated_vcf_table, guess_max = 1000000) |>
filter(!is.na(ALLELEID))
patho <- filter(ann, str_detect(CLNSIG, fixed("Pathogenic")) | str_detect(CLNSIG, fixed("Likely_pathogenic"))) |> separate("ID", c("ID","unknown"), sep = ";")
suppressPackageStartupMessages(library(tidyverse))
annotated_vcf_table <- "C:/Users/jmcgirr/dna/kimiko/vcf/myVariants.clinvar.txt"
ann <- read_table(annotated_vcf_table, guess_max = 1000000) |>
filter(!is.na(ALLELEID))
patho <- filter(ann, str_detect(CLNSIG, fixed("Pathogenic")) | str_detect(CLNSIG, fixed("Likely_pathogenic"))) |> separate("ID", c("ID","unknown"), sep = ";")
unique(patho$CLNSIG)
nrow(patho)
head(patho)
view(patho)
ann
annotated_vcf_table <- "C:/Users/jmcgirr/dna/vcf/myVariants.clinvar.txt"
ann <- read_table(annotated_vcf_table, guess_max = 1000000) |>
filter(!is.na(ALLELEID))
annotated_vcf_table <- "C:/Users/jmcgirr/dna/nebula/vcf/myVariants.clinvar.txt"
ann <- read_table(annotated_vcf_table, guess_max = 1000000) |>
filter(!is.na(ALLELEID))
patho_j <- filter(ann, str_detect(CLNSIG, fixed("Pathogenic")) | str_detect(CLNSIG, fixed("Likely_pathogenic"))) |> separate("ID", c("ID","unknown"), sep = ";")
patho_j
annotated_vcf_table <- "C:/Users/jmcgirr/dna/kimiko/vcf/myVariants.clinvar.txt"
ann <- read_table(annotated_vcf_table, guess_max = 1000000) |>
filter(!is.na(ALLELEID))
patho_k <- filter(ann, str_detect(CLNSIG, fixed("Pathogenic")) | str_detect(CLNSIG, fixed("Likely_pathogenic"))) |> separate("ID", c("ID","unknown"), sep = ";")
patho_k
intersect(patho_k$ID, patho_j$ID)
k <- select(patho_k, c(CHROM, POS, TYPE, ID, myVariants.GT)) |>
rename(k_GT = myVariants.GT)
k
k <- select(patho_k, c(CHROM, POS, TYPE, ID, myVariants.GT, myVariants.AD, myVariants.GQ)) |>
rename(k_GT = myVariants.GT, myVariants.AD = k_AD, myVariants.GQ = k_GQ)
j <- select(patho_j, c(CHROM, POS, TYPE, ID, myVariants.GT, myVariants.AD, myVariants.GQ)) |>
rename(j_GT = myVariants.GT, j_AD = myVariants.AD, j_GQ = myVariants.GQ)
k <- select(patho_k, c(CHROM, POS, TYPE, ID, myVariants.GT, myVariants.AD, myVariants.GQ)) |>
rename(k_GT = myVariants.GT, k_AD = myVariants.AD, k_GQ = myVariants.GQ)
j <- select(patho_j, c(CHROM, POS, TYPE, ID, myVariants.GT, myVariants.AD, myVariants.GQ)) |>
rename(j_GT = myVariants.GT, j_AD = myVariants.AD, j_GQ = myVariants.GQ)
inner_join(j,k)
j
j <- select(patho_j, c(CHROM, POS, TYPE, ID, myVariants.GT, myVariants.AD, myVariants.GQ)) |>
rename(j_GT = myVariants.GT, j_AD = myVariants.AD, j_GQ = myVariants.GQ) |>
separate(j_GT, into = c("ref", "alt"), sep = "/") |>
mutate(genebe = paste(CHROM, POS, ref, alt, sep = "-"))
j
j$genebe <- paste0("https://genebe.net/variant/hg38/", j$genebe)
j
ann
ann
myVariants_path <- "C:/Users/jmcgirr/dna/kimiko/vcf/myVariants.ann.txt"
vcf <- read_tsv(myVariants_path)
vcf
inner_join(j,k)
make.hyperlink <-  function(myurl,mytext=myurl) {
paste('<a href="',myurl,'">',mytext,'</a>')
}
j <- select(patho_j, c(CHROM, POS, TYPE, ID, myVariants.GT, myVariants.AD, myVariants.GQ)) |>
rename(j_GT = myVariants.GT, j_AD = myVariants.AD, j_GQ = myVariants.GQ) |>
separate(j_GT, into = c("ref", "alt"), sep = "/") |>
mutate(genebe = paste0("https://genebe.net/variant/hg38/", ID)) |>
mutate(genebe = make.hyperlink(genebe))
j
j <- select(patho_j, c(CHROM, POS, TYPE, ID, myVariants.GT, myVariants.AD, myVariants.GQ)) |>
rename(j_GT = myVariants.GT, j_AD = myVariants.AD, j_GQ = myVariants.GQ) |>
separate(j_GT, into = c("ref", "alt"), sep = "/") |>
mutate(genebe_url = paste0("https://genebe.net/variant/hg38/", ID)) |>
mutate(genebe_url = make.hyperlink(genebe))
gt(j) |>
tab_header(title = "Joe's variants annotated as pathoginic or likely pathogenic") |>
fmt (columns = 'genebe_url',fns = make.hyperlink))
gt(j) |>
tab_header(title = "Joe's variants annotated as pathoginic or likely pathogenic") |>
fmt(columns = 'genebe_url',fns = make.hyperlink)
library(gt)
gt(j) |>
tab_header(title = "Joe's variants annotated as pathoginic or likely pathogenic") |>
fmt(columns = 'genebe_url',fns = make.hyperlink)
j <- select(patho_j, c(CHROM, POS, TYPE, ID, myVariants.GT, myVariants.AD, myVariants.GQ)) |>
rename(j_GT = myVariants.GT, j_AD = myVariants.AD, j_GQ = myVariants.GQ) |>
separate(j_GT, into = c("ref", "alt"), sep = "/") |>
mutate(genebe_url = paste0("https://genebe.net/variant/hg38/", ID)) |>
mutate(genebe_url = make.hyperlink(genebe))
j <- select(patho_j, c(CHROM, POS, TYPE, ID, myVariants.GT, myVariants.AD, myVariants.GQ)) |>
rename(j_GT = myVariants.GT, j_AD = myVariants.AD, j_GQ = myVariants.GQ) |>
separate(j_GT, into = c("ref", "alt"), sep = "/") |>
mutate(genebe_url = paste0("https://genebe.net/variant/hg38/", ID)) |>
mutate(genebe_url = make.hyperlink(genebe_url))
gt(j) |>
tab_header(title = "Joe's variants annotated as pathoginic or likely pathogenic") |>
fmt(columns = 'genebe_url',fns = make.hyperlink)
gt(inner_join(j,k)) |>
tab_header(title = "Jomiko variants annotated as pathoginic or likely pathogenic") |>
fmt(columns = 'genebe_url',fns = make.hyperlink)
k <- select(patho_k, c(CHROM, POS, TYPE, ID, myVariants.GT, myVariants.AD, myVariants.GQ)) |>
rename(k_GT = myVariants.GT, k_AD = myVariants.AD, k_GQ = myVariants.GQ) |>
separate(k_GT, into = c("ref", "alt"), sep = "/") |>
mutate(genebe_url = paste0("https://genebe.net/variant/hg38/", ID)) |>
mutate(genebe_url = make.hyperlink(genebe_url))
j <- select(patho_j, c(CHROM, POS, TYPE, ID, myVariants.GT, myVariants.AD, myVariants.GQ)) |>
rename(j_GT = myVariants.GT, j_AD = myVariants.AD, j_GQ = myVariants.GQ) |>
separate(j_GT, into = c("ref", "alt"), sep = "/") |>
mutate(genebe_url = paste0("https://genebe.net/variant/hg38/", ID)) |>
mutate(genebe_url = make.hyperlink(genebe_url))
gt(inner_join(j,k)) |>
tab_header(title = "Jomiko variants annotated as pathoginic or likely pathogenic") |>
fmt(columns = 'genebe_url',fns = make.hyperlink)
k <- select(patho_k, c(CHROM, POS, TYPE, ID, myVariants.GT, myVariants.AD, myVariants.GQ)) |>
rename(k_GT = myVariants.GT, k_AD = myVariants.AD, k_GQ = myVariants.GQ) |>
mutate(genebe_url = paste0("https://genebe.net/variant/hg38/", ID)) |>
mutate(genebe_url = make.hyperlink(genebe_url, ID))
j <- select(patho_j, c(CHROM, POS, TYPE, ID, myVariants.GT, myVariants.AD, myVariants.GQ)) |>
rename(j_GT = myVariants.GT, j_AD = myVariants.AD, j_GQ = myVariants.GQ) |>
mutate(genebe_url = paste0("https://genebe.net/variant/hg38/", ID)) |>
mutate(genebe_url = make.hyperlink(genebe_url, ID))
gt(k) |>
tab_header(title = "Kimiko's variants annotated as pathoginic or likely pathogenic") |>
fmt(columns = 'genebe_url',fns = make.hyperlink)
j <- select(patho_j, c(CHROM, POS, TYPE, ID, myVariants.GT, myVariants.AD, myVariants.GQ)) |>
rename(j_GT = myVariants.GT, j_AD = myVariants.AD, j_GQ = myVariants.GQ) |>
mutate(genebe_url = paste0("https://genebe.net/variant/hg38/", ID))# |>
gt(j) |>
tab_header(title = "Joe's variants annotated as pathoginic or likely pathogenic") |>
fmt(columns = 'genebe_url',fns = make.hyperlink)
myVariants_path <- "C:/Users/jmcgirr/dna/nebula/vcf/myVariants.ann.txt"
# Nebula vcf
vcf <- read_tsv(myVariants_path, col_select = c("CHROM","POS","TYPE","ID","myVariants.GT"))
vcf
filter(vcf, CHROM == "chr1", POS = 77166727)
filter(vcf, CHROM == "chr1", POS == 77166727)
filter(vcf, CHROM == "chr3", POS == 195781618)
filter(vcf, CHROM == "chr11", POS == 1017466)
filter(vcf, CHROM == "chr16", POS == 53649038)
myVariants_path <- "C:/Users/jmcgirr/dna/kimiko/vcf/myVariants.ann.txt"
# Nebula vcf
vcf <- read_tsv(myVariants_path, col_select = c("CHROM","POS","TYPE","ID","myVariants.GT"))
filter(vcf, CHROM == "chr8", POS == 91071260)
myVariants_path <- "C:/Users/jmcgirr/dna/kimiko/vcf/myVariants.txt"
# Nebula vcf
vcf <- read_tsv(myVariants_path, col_select = c("CHROM","POS","TYPE","ID","myVariants.GT"))
myVariants_path <- "C:/Users/jmcgirr/dna/nebula/vcf/myVariants.txt"
# Nebula vcf
vcf <- read_tsv(myVariants_path, col_select = c("CHROM","POS","TYPE","ID","myVariants.GT"))
filter(vcf, CHROM == "chr1", POS == 77166727)
filter(vcf, CHROM == "chr3", POS == 195781618)
filter(vcf, CHROM == "chr11", POS == 1017466)
filter(vcf, CHROM == "chr16", POS == 53649038)
annotated_vcf_table <- "C:/Users/jmcgirr/dna/nebula/vcf/myVariants.clinvar.txt"
ann <- read_table(annotated_vcf_table, guess_max = 1000000) |>
filter(!is.na(ALLELEID))
start_time <- Sys.time()
suppressPackageStartupMessages(library(tidyverse))
library(rsnps)
library(gt)
#library(beepr)
# Wong, B. Points of view: Color blindness. Nat Methods (2011).
bla <- '#000000'
blu <- '#0072b2'
grb <- '#56b4e9'
lir <- '#cc79a7'
gre <- '#009e73'
red <- '#d55e00'
org <- '#e69f00'
yel <- '#f0e442'
gry <- '#BBBBBB'
annotated_vcf_table <- "C:/Users/jmcgirr/dna/nebula/vcf/myVariants.clinvar.txt"
ann <- read_table(annotated_vcf_table, guess_max = 1000000) |>
filter(!is.na(ALLELEID))
patho <- filter(ann, str_detect(CLNSIG, fixed("Pathogenic")) | str_detect(CLNSIG, fixed("Likely_pathogenic"))) |> separate("ID", c("ID","unknown"), sep = ";")
#unique(patho$CLNSIG)
#nrow(patho)
as.data.frame(patho) |> gt()
patho <- filter(ann, str_detect(CLNSIG, fixed("aPathogenic")) | str_detect(CLNSIG, fixed("aLikely_pathogenic"))) |> separate("ID", c("ID","unknown"), sep = ";")
#unique(patho$CLNSIG)
#nrow(patho)
as.data.frame(patho) |> gt()
annotated_vcf_table <- "C:/Users/jmcgirr/dna/nebula/vcf/myVariants.ann.txt"
ann <- read_table(annotated_vcf_table, guess_max = 1000000)
# table based on SnpEFF documentation
ann_types <- data.frame(impact = c("HIGH","HIGH","HIGH","HIGH","HIGH","HIGH","HIGH","HIGH","HIGH","HIGH","MODERATE","MODERATE","MODERATE","MODERATE","MODERATE","MODERATE","MODERATE","MODERATE","MODERATE","MODERATE","MODERATE","LOW","LOW","LOW","LOW","LOW","LOW","MODIFIER","MODIFIER","MODIFIER","MODIFIER","MODIFIER","MODIFIER","MODIFIER","MODIFIER","MODIFIER","MODIFIER","MODIFIER","MODIFIER","MODIFIER","MODIFIER","MODIFIER","MODIFIER","MODIFIER","MODIFIER","MODIFIER","MODIFIER","MODIFIER","MODIFIER","MODIFIER","MODIFIER","MODIFIER"),
ontology_term = c("chromosome_number_variation","exon_loss_variant","frameshift_variant","rare_amino_acid_variant","splice_acceptor_variant","splice_donor_variant","start_lost","stop_gained","stop_lost","transcript_ablation","3_prime_UTR_truncation&exon_loss","5_prime_UTR_truncation&exon_loss_variant","coding_sequence_variant-moderate","conservative_inframe_deletion","conservative_inframe_insertion","disruptive_inframe_deletion","disruptive_inframe_insertion","missense_variant","regulatory_region_ablation","splice_region_variant-moderate","TFBS_ablation","5_prime_UTR_premature_start_codon_gain_variant","initiator_codon_variant","splice_region_variant-low","start_retained","stop_retained_variant","synonymous_variant","3_prime_UTR_variant","5_prime_UTR_variant","coding_sequence_variant-modifier","conserved_intergenic_variant","conserved_intron_variant","downstream_gene_variant","exon_variant","feature_elongation","feature_truncation","gene_variant","intergenic_region","intragenic_variant","intron_variant","mature_miRNA_variant","miRNA","NMD_transcript_variant","non_coding_transcript_exon_variant","non_coding_transcript_variant","regulatory_region_amplification","regulatory_region_variant","TF_binding_site_variant","TFBS_amplification","transcript_amplification","transcript_variant","upstream_gene_variant"))
ann_types |> gt() |> tab_header(title = "Putative impact for sequence ontology terms output by SnpEFF")
# count the number of variants annotated for each ontology
n_variants <- vector("double", length(ann_types$ontology_term))
for(i in seq_along(ann_types$ontology_term)){
n_variants[[i]] <- filter(ann, str_detect(ANN, fixed(ann_types$ontology_term[[i]]))) |> nrow()
}
ann_types$n_variants <- n_variants
ann_types <- arrange(ann_types, n_variants)
ann_types$ontology_term <- factor(ann_types$ontology_term, levels = ann_types$ontology_term)
ann_types$impact <- factor(ann_types$impact, levels = c("HIGH","MODERATE","LOW","MODIFIER"))
ann_types$log_n_variants <- log10(ann_types$n_variants)
p1 <- ann_types|>
ggplot(aes(ontology_term, log_n_variants, fill = impact)) +
geom_col() +
coord_flip() +
theme_minimal() +
theme(axis.title.x=element_text(size=14),
axis.title.y=element_text(size=12),
axis.title=element_text(size=14),
axis.text=element_text(size=12),
plot.title=element_text(size=18))+
ylab("\nlog(number of annotated variants)")+ xlab("")+ ylim(0,8)+
ggtitle("Number of variants showing each snpEFF annotation (log scale)")+
geom_text(aes(label=n_variants), position=position_stack(), hjust=-0.5)+
scale_fill_manual(values = c(red,yel,blu,gre))
# get table with rsids for an ontology term
annotations.for.ontology.term <- function(ontology_term){
ot_table <- filter(ann, str_detect(ANN, fixed(ontology_term)))
anns <- ot_table$ANN
ot_anns <- c()
ot_alleles <- c()
for(ann_string in anns){
ot_anns <- c(ot_anns,paste0(paste(strsplit(grep(ontology_term, strsplit(ann_string, ",")[[1]], value = TRUE)[1], "\\|")[[1]][c(1,2,3,4,7)], collapse = "|"),"|"))
}
ot_table$ANN <- ot_anns
ot_table <- separate(ot_table,ANN, c("allele","annotation","impact","gene_name","feature_id"), sep = "\\|", extra = "drop")
return(ot_table)
}
# search for SNPedia annotations for rsids output by annotations.for.ontology.term()
get.snpedia.urls <- function(ot_table){
snpedia_urls <- c()
myGTs  <- myADs <- myGQs <- c()
ot_table <- filter(ot_table, grepl("rs",ID))
for(rsid in ot_table$ID){
snpedia_table <- annotations(snp = rsid, output = 'snpedia')
if(nrow(snpedia_table)>0){
snpedia_urls <- c(snpedia_urls,gsub("\\s*\\([^\\)]+\\)","",snpedia_table$url[1]))
myGTs <- c(myGTs, filter(ot_table, ID == rsid) |> pull(myVariants.GT))
myADs <- c(myADs, filter(ot_table, ID == rsid) |> pull(myVariants.AD))
myGQs <- c(myGQs, filter(ot_table, ID == rsid) |> pull(myVariants.GQ))
}
}
return(data.frame(SNPedia_urls = snpedia_urls, Genotype_PlusOrientation = myGTs,
Allele_Depth = myADs, Genotype_Quality = myGQs))
}
make.hyperlink <-  function(myurl,mytext=myurl) {
paste('<a href="',myurl,'">',mytext,'</a>')
}
filter(ann_types, impact == "HIGH", n_variants > 0)
length( filter(ann_types, impact == "HIGH", n_variants > 0) |> pull(ontology_term) ) > 0
for(i_ontology_term in (filter(ann_types, impact == "HIGH", n_variants > 0) |> pull(ontology_term))){
if(nrow(get.snpedia.urls(annotations.for.ontology.term(i_ontology_term))) > 0){
print(get.snpedia.urls(annotations.for.ontology.term(i_ontology_term)) |>
gt() |>
tab_header(title = paste0("SNPedia entries for variants annotated as ", i_ontology_term)) |>
fmt (columns = 'SNPedia_urls',fns = make.hyperlink))
}
}
head(ann)
ann_types
ann_types$ontology_term[[i]]
ann_types$ontology_term[i]
n_variants
4581+322+2055
12000?3
12000/3
library(knitr)
my.jekyll.site <- "joemcgirr.github.io"
KnitPost <- function(input, base.url = my.jekyll.site) {
opts_knit$set(base.url = base.url)
fig.path <- paste0("images/", sub(".Rmd$", "", basename(input)), "/")
opts_chunk$set(fig.path = fig.path)
opts_chunk$set(fig.cap = "center")
render_jekyll()
knit(input, envir = parent.frame())
}
setwd("C:/Users/joseph.mcgirr/Personal/Github/joemcgirr.github.io/_pages/")
KnitPost("C:/Users/joseph.mcgirr/Personal/Github/joemcgirr.github.io/_pages/fun_projects.Rmd")
#setwd("C:/Users/jmcgirr/Documents/GitHub/my_website/_pages/")
#KnitPost("C:/Users/jmcgirr/Documents/GitHub/my_website/_pages/fun_projects.Rmd")
setwd("C:/Users/jmcgirr/Documents/GitHub/my_website/_pages/")
KnitPost("C:/Users/jmcgirr/Documents/GitHub/my_website/_pages/fun_projects.Rmd")
KnitPost("C:/Users/jmcgirr/Documents/GitHub/my_website/_pages/fun_projects.Rmd")
KnitPost("C:/Users/jmcgirr/Documents/GitHub/my_website/_pages/fun_projects.Rmd")
